"use strict";function Entry(a,b,c,d,e){this.title=a,this.deep=b,this.endDate=c,this.type=d,this.html=e}function Timeline(a){this.entries=a&&a.entries||[],this.minDeep=a&&a.minDeep||1,this.currentDeep=a&&a.currentDeep||1,this.maxDeep=a&&a.maxDeep||1}Timeline.prototype.addEntry=function(a,b,c,d,e){this.entries.push(new Entry(a,b,c,d,e)),this.maxDeep=b>this.maxDeep?b:this.maxDeep,this.minDeep=b<this.minDeep?b:this.minDeep},Timeline.prototype.getEntriesFromToDeep=function(a,b,c){for(var d=[],e=0,f=this.entries.length;f>e;e++){var g=this.entries[e],h=g.deep>=a&&g.deep<=b;!c&&h?d.push(g):c&&h&&(g.type===c||-1!==c.indexOf(g.type))&&d.push(g)}return d},Timeline.prototype.hasEntriesForNextDeep=function(a){for(var b=0,c=this.entries.length;c>b;b++){var d=this.entries[b],e=d.deep>this.currentDeep;if(!a&&e||a&&e&&(d.type===a||-1!==a.indexOf(d.type)))return!0}return!1},Timeline.prototype.getEntriesOfDeep=function(a,b){return this.getEntriesFromToDeep(a,a,b)},Timeline.prototype.getEntriesUpToDeep=function(a){return this.getEntriesFromToDeep(this.minDeep,this.currentDeep,a)},Timeline.prototype.getNextDeepEntries=function(a){return this.getEntriesOfDeep(++this.currentDeep,a)},Timeline.prototype.isLastDeep=function(){return this.currentDeep===this.maxDeep},$.fn.timeline=function(a){var b=a&&a.isOneDeep||!1,c=$(this),d=c.find(".timeline-box"),e=c.find(".timeline__legend a"),f=c.find(".timeline__button"),g=c.find(".timeline__content"),h=[],i=new Timeline,j=function(a){return"current"===a?new Date:(a=a.split("-"),new Date(a[0],a[1],a[2]))},k=function(a,b,c,d,e){b=b||1,c=j(c),i.addEntry(a,b,c,d,e),-1===h.indexOf(d)&&h.push(d)},l=function(a){var b=c.find(".timeline-block[data-year="+(parseInt(a.endDate.getFullYear())+1)+"]"),d=b.find(".timeline-box"),e=null;a.html=$(a.html).css({opacity:.1}).animate({opacity:1}),b.length||(b=c.find(".timeline-block").first()),d.each(function(b){return a.endDate>=j($(this).data("end"))?(e=b,!1):void 0}),null!==e?d.eq(e).before(a.html):b.append(a.html)},m=function(a){i.getNextDeepEntries(a).forEach(function(a){l(a)})},n=function(a){i.getEntriesUpToDeep(a).forEach(function(a){l(a)})},o=function(a){g.find('[data-type="'+a+'"]').animate({opacity:.1},{duration:200,complete:function(){$(this).remove()}})},p=function(){var a=$(this),b=a.data("type");a.hasClass("legend__link_disabled")?(h.push(b),n(b),a.removeClass("legend__link_disabled")):(h.splice(h.indexOf(b),1),o(b),a.addClass("legend__link_disabled")),!i.isLastDeep()&&i.hasEntriesForNextDeep(b)&&f.trigger("toggle")},q=function(a){a.preventDefault();var b=$(this),c=b.siblings().filter(".legend__link_disabled"),d=!b.hasClass("legend__link_disabled"),f=e.length;switch(f){case 1:break;case 2:d&&c&&c.trigger("toggle");break;default:var g=b.siblings().filter(":not(.legend__link_disabled)"),h=c.length===f-2;d&&h?g.addClass("legend__link_not-toggle").off("toggle"):!d&&h&&g.removeClass("legend__link_not-toggle").on("toggle",p)}b.trigger("toggle")},r=function(){f.hasClass("disabled")?f.removeClass("disabled").on("click",s):f.addClass("disabled").off("click")},s=function(){if(b)for(;!i.isLastDeep();)m(h);else m(h);i.isLastDeep()&&f.trigger("toggle")},t=function(){d.each(function(){var a=$(this);k(a.find(".timeline-box__title a").text().trim(),a.data("deep"),a.data("end"),a.data("type"),$("<p>").append(a.eq(0).clone()).html())}).filter("[data-deep]").remove(),f.on("click",s).on("toggle",r),e.on("click",q).on("toggle",p)};t()};