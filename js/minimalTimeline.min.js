"use strict";function Entry(a,b,c,d,e){this.title=a,this.deep=b,this.endDate=c,this.type=d,this.html=e}function Timeline(a){this.entries=a&&a.entries||[],this.minDeep=a&&a.minDeep||1,this.currentDeep=a&&a.currentDeep||1,this.maxDeep=a&&a.maxDeep||1}Timeline.prototype.addEntry=function(a,b,c,d,e){this.entries.push(new Entry(a,b,c,d,e)),this.maxDeep=b>this.maxDeep?b:this.maxDeep,this.minDeep=b<this.minDeep?b:this.minDeep},Timeline.prototype.getEntriesFromToDeep=function(a,b,c){for(var d=[],e=0,f=this.entries.length;f>e;e++){var g=this.entries[e],h=g.deep>=a&&g.deep<=b;!c&&h?d.push(g):c&&h&&(g.type===c||-1!==c.indexOf(g.type))&&d.push(g)}return d},Timeline.prototype.hasEntriesForNextDeep=function(a){for(var b=0,c=this.entries.length;c>b;b++){var d=this.entries[b],e=d.deep>this.currentDeep;if(!a&&e||a&&e&&(d.type===a||-1!==a.indexOf(d.type)))return!0}return!1},Timeline.prototype.getEntriesOfDeep=function(a,b){return this.getEntriesFromToDeep(a,a,b)},Timeline.prototype.getEntriesUpToDeep=function(a){return this.getEntriesFromToDeep(this.minDeep,this.currentDeep,a)},Timeline.prototype.getNextDeepEntries=function(a){return this.getEntriesOfDeep(++this.currentDeep,a)},Timeline.prototype.isLastDeep=function(){return this.currentDeep===this.maxDeep},$.fn.timeline=function(){var a=$(this),b=a.find(".box"),c=a.find(".legend a"),d=a.find("button"),e=a.find(".content"),f=[],g=new Timeline,h=function(a){return"current"===a?new Date:(a=a.split("-"),new Date(a[0],a[1],a[2]))},i=function(a,b,c,d,e){b=b||1,c=h(c),g.addEntry(a,b,c,d,e),-1===f.indexOf(d)&&f.push(d)},j=function(b){var c=a.find(".block[data-year="+(parseInt(b.endDate.getFullYear())+1)+"]"),d=c.find(".box"),e=null;b.html=$(b.html).css({opacity:.1}).animate({opacity:1}),c.length||(c=a.find(".block").first()),d.each(function(a){return b.endDate>=h($(this).data("end"))?(e=a,!1):void 0}),null!==e?d.eq(e).before(b.html):c.append(b.html)},k=function(a){g.getNextDeepEntries(a).forEach(function(a){j(a)})},l=function(a){g.getEntriesUpToDeep(a).forEach(function(a){j(a)})},m=function(a){e.find('[data-type="'+a+'"]').animate({opacity:.1},{duration:200,complete:function(){$(this).remove()}})},n=function(){var a=$(this),b=a.data("type");a.hasClass("disabled")?(f.push(b),l(b),a.removeClass("disabled")):(f.splice(f.indexOf(b),1),m(b),a.addClass("disabled")),!g.isLastDeep()&&g.hasEntriesForNextDeep(b)&&d.trigger("toggle")},o=function(a){a.preventDefault();var b=$(this),d=b.siblings().filter(".disabled"),e=!b.hasClass("disabled"),f=c.length;switch(f){case 1:break;case 2:e&&d&&d.trigger("toggle");break;default:var g=b.siblings().filter(":not(.disabled)"),h=d.length===f-2;e&&h?g.addClass("not-toggle").off("toggle"):!e&&h&&g.removeClass("not-toggle").on("toggle",n)}b.trigger("toggle")},p=function(){d.hasClass("disabled")?d.removeClass("disabled").on("click",q):d.addClass("disabled").off("click")},q=function(){k(f),g.isLastDeep()&&d.trigger("toggle")},r=function(){b.each(function(){var a=$(this);i(a.find(".title a").text().trim(),a.data("deep"),a.data("end"),a.data("type"),$("<p>").append(a.eq(0).clone()).html())}).filter("[data-deep]").remove(),d.on("click",q).on("toggle",p),c.on("click",o).on("toggle",n)};r()};